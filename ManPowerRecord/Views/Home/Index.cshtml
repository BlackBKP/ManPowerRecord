@{
    ViewData["Title"] = "Home";
}
<div class="row p-3">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>

<!-- Task Modal -->
<div class="modal fade" id="modal_task" tabindex="-1" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_task_title">Add Tasks</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="job">Job</label>
                        @*<input id="job" type="text" class="form-control" placeholder="JXX-XXXX" />*@
                        <select id="job" class="form-control">
                            <option value="" selected disabled>Please Select Job</option>
                            <option value="J22-9999">J22-9999</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="start_date">Start Date</label>
                        <input id="start_date" type="date" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="stop_date">Stop Date</label>
                        <input id="stop_date" type="date" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="start_time">Start Time</label>
                        <input id="start_time" type="time" class="form-control" value="08:30"/>
                    </div>
                    <div class="form-group">
                        <label for="stop_time">Stop Time</label>
                        <input id="stop_time" type="time" class="form-control" value="17:30"/>
                    </div>
                    <div class="form-group">
                        <label for="task">Task</label>
                        <select id="task" class="form-control">
                            <option value="" selected disabled>Please Select Task</option>
                            <option>Task 1</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Accept</button>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script type="text/javascript">

        var calendar;
        var calendarEl;
        $(document).ready(function () {
            calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'dayGridMonth,listMonth,timeGridWeek,timeGridDay',
                    center: 'title',
                    right: 'prev,next'
                },
                events: [
                    {
                        title: 'New Year',
                        start: '2022-01-01',
                        end: '2022-01-04',
                        allDay: true,
                        editable: false
                    },
                    {
                        title: 'Meeting 1',
                        start: '2022-01-04',
                        end: '2022-01-05',
                        allDay: false,
                    },
                    {
                        title: 'Meeting 2',
                        start: '2022-01-04',
                        end: '2022-01-05',
                        allDay: false,
                    },
                    {
                        title: 'Meeting 3',
                        start: '2022-01-04',
                        end: '2022-01-05',
                        allDay: false,
                    },
                    {
                        daysOfWeek: [0, 6],
                        display: "background",
                        color: "#80808080",
                        overLap: true,
                        allDay: true
                    },
                    {
                        title: 'Test Job',
                        start: '2022-01-25T08:30:00',
                        end: '2022-01-30T12:00:00',
                        allDay: true,
                        overLap: true,
                        color: '#FF0033',
                        extendedProps: {
                            job_id: 'J22-0001',
                            task_id: 'T00001',
                            description: 'Job 22-0001 Task 1',
                        }
                    },
                    {
                        id: '0',
                        title: 'Project Meeting',
                        start: '2022-01-07T08:30:00',
                        end: '2022-01-07T12:00:00',
                        overLap: true,
                        allDay: false,
                        color: '#FF000033',
                    },
                    {
                        id: '1',
                        title: 'Lunch',
                        start: '2022-01-07T12:00:00',
                        end: '2022-01-07T13:00:00',
                        overLap: true,
                        allDay: false,
                        color: '#80808033',
                    },
                    {
                        title: 'Project Meeting 2',
                        start: '2022-01-07T13:00:00',
                        end: '2022-01-07T17:30:00',
                        overLap: true,
                        allDay: false,
                        color: '#00FF0033',
                    },
                ],
                height: 650,
                @*dateClick: function (info) {
                    alert('Date: ' + info.dateStr);
                },*@
                editable: true,
                selectable: true,
                select: function (info) {
                    //console.log(info);
                    var date_start = info.startStr;
                    var date_end = info.endStr;
                    //console.log(date_start + " to " + date_end);
                    AddTask(date_start, date_end)
                },
                eventClick: function (info) {
                    //console.log(info);
                    //console.log(info.event.extendedProps);
                    EditTask(info.event);
                    @*alert('Event: ' + info.event.title);
                    var e = calendar.getEventById(info.event.id);
                    e.remove();*@
                },
                @*editable: true,
                selectable: true,
                unselectAuto: true,*@
                @*select: function (startDate, endDate) {
                    var start = new Date(startDate.format());
                    var stop = new Date(endDate.format());
                    stop = new Date(stop.setDate(stop.getDate() - 1));
                    var start_date = start.toISOString().split('T')[0];
                    var stop_date = stop.toISOString().split('T')[0];
                    if (start_date === stop_date) {
                        $('#taskmodal').modal();
                        $('#start_date').val(start_date);
                        $('#stop_date').val(stop_date);
                    }
                    else {
                        $('#taskmodal').modal();
                        $('#start_date').val(start_date);
                        $('#stop_date').val(stop_date);
                    }
                }*@
            });
            calendar.render();
        });

        $('#btn_add_task').on('click', function () {
            var available = true;
            available = $('#start_task').val() !== null ? true : false;
            available = $('#stop_task').val() !== null ? true : false;
            available = $('#task_job_id').val() !== null ? true : false;
            available = $('#task_description').val() !== null ? true : false;
            if (available) {
                calendar.addEvent({
                    title: $('#task_job_id').val(),
                    start: $('#start_task').val(),
                    allDay: true
                });
                calendar.render();
                alert("done");
                $('#start_task').val(null);
                $('#stop_task').val(null);
                $('#task_job_id').val(null);
                $('#task_description').val(null);
            }
        });

        function AddTask(date_start, date_end) {
            $('#modal_task').modal();
            $('#modal_task_title').text("Add Task");
            $('#job').val();
            $('#start_date').val(date_start);
            $('#stop_date').val(date_end);
            $('#task').val();
        }

        function EditTask(event) {
            var task = event;
            console.log(task);
            $('#modal_task').modal();
            $('#modal_task_title').text("Edit Task");
            $('#job').val(task.extendedProps.job_id);
            $('#start_date').val(task.startStr);
            $('#stop_date').val(task.endStr);
            $('#task').val(task.extendedProps.description);
        }

    </script>
}